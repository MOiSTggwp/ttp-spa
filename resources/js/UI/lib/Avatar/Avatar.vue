<template>
    <div class="w-[300px] flex flex-column items-center">
        <div v-if="edit" class="w-[290px] max-w-fit flex justify-center flex-wrap overflow-y-auto gap-1">
            <button
                v-for="btn in buttons"
                @click="target = btn.type"
                class="px-1 py-0.5 border-r-2 border-l-2 border-t-2 border-Dark-m rounded-t-md bg-Dark"
                :class="{'border-Info': target === btn.type, 'hover:border-white/50': target !== btn.type}"
            >
                <span v-html="btn.svg"></span>
            </button>
        </div>
        <div class="flex justify-between items-center w-full">
            <button
                v-if="edit"
                @click="setTargetSvg('prev')"
                class="max-h-10 px-[1px] py-[3px] border-b-2 border-l-2 border-t-2 border-Dark-m rounded-l-md
                bg-Dark text-Dark-m disabled:opacity-50"
                :class="{'hover:text-white': !disabledOn()}"
                :disabled="disabledOn()"
            >
                <ChevronLeft class="w-4 h-4"></ChevronLeft>
            </button>
            <div class="border-Dark-m border-2 rounded-md">
                <span v-html="fullSvg"></span>
            </div>
            <button
                v-if="edit"
                @click="setTargetSvg('next')"
                class="max-h-10 px-[1px] py-[3px] border-b-2 border-r-2 border-t-2 border-Dark-m rounded-r-md
                bg-Dark text-Dark-m disabled:opacity-50"
                :class="{'hover:text-white': !disabledOn()}"
                :disabled="disabledOn()"
            >
                <ChevronRight class="w-4 h-4"></ChevronRight>
            </button>
        </div>
        <div v-if="edit" class="w-[240px] max-w-fit max-h-[58px] flex flex-wrap overflow-y-auto gap-x-1 gap-y-1.5 px-1 py-0.5
        border-r-2 border-l-2 border-b-2 border-Dark-m rounded-b-md bg-Dark">
            <div
                v-for="color in colors"
                :key="color.id"
                class="w-6 h-6 overflow-hidden rounded-md relative cursor-pointer border-1 border-Dark hover:border-white"
                :style="colorize(color.color)"
                @click="setFillSvg(color)"
            >
                <div v-if="getFillSvg(color)" class="absolute top-0 left-0 w-6 h-6 pl-1 text-white bg-Dark-m/50">&#10004;</div>
            </div>
        </div>
    </div>
</template>

<script>
import {ChevronLeft, ChevronRight} from 'lucide-vue';
import {mapActions} from "vuex";

export default {
    name: "U-Avatar",
    components: {
        ChevronLeft,
        ChevronRight
    },
    props:{
        id: {
            default: null
        },
        edit: {
            default: true
        }
    },
    data() {
        return {
            uid: null,
            fullSvg: '',
            result: [
                {type: 'main', color_id: null, element_id: null,},
                {type: 'hair', color_id: null, element_id: null,},
                {type: 'eyes', color_id: null, element_id: null,},
                {type: 'lips', color_id: null, element_id: null,},
                {type: 'other1', color_id: null, element_id: null,},
                {type: 'other2', color_id: null, element_id: null,},
                {type: 'other3', color_id: null, element_id: null,},
                {type: 'garb', color_id: null, element_id: null,},
            ],
            els: [],

            elems: [],
            colors: [],

            target: 'main',
            buttons: [
                { type: 'main', svg: '<svg width="14" height="14" viewBox="0 0 118 180" fill="none" xmlns="http://www.w3.org/2000/svg">\n' +
                        '<path fill-rule="evenodd" clip-rule="evenodd" d="M109.368 65.791C109.371 65.6965 109.373 65.602 109.373 65.5075C109.489 56.972 109.069 51.1241 109.069 51.1241C109.195 23.3756 86.7379 0.824081 59 0.824081C31.2621 0.824081 8.80501 23.3756 8.93099 51.1241C8.93099 51.1241 8.51101 56.972 8.62655 65.5075C8.62655 65.602 8.62918 65.6965 8.6318 65.791C8.63443 65.8855 8.63706 65.98 8.63706 66.0744V66.1585C8.64887 66.8203 8.66401 67.4973 8.68291 68.1879C6.90362 67.4052 4.82551 67.3346 3.44793 68.5075C1.35866 70.2608 0.802214 73.8619 0.58174 76.4131C0.182784 81.0221 1.28516 85.6941 2.99647 89.9461C4.7417 94.2523 8.07218 99.4153 12.7092 100.736C14.2337 106.725 16.3014 112.397 19.0939 117.162C21.9916 122.117 25.1307 126.432 28.3434 130.149C28.8578 130.747 29.3723 131.335 29.8972 131.902L29.5402 138.852L28.0599 167.01L28.0588 167.032C27.8783 170.455 29.9673 173.599 33.1982 174.743C49.8875 180.653 68.1113 180.653 84.8007 174.744C88.0321 173.599 90.1213 170.455 89.9401 167.031L88.4597 138.852L88.1028 131.902C88.6277 131.335 89.1422 130.747 89.6566 130.149C92.8693 126.432 96.0084 122.117 98.9061 117.162C101.699 112.397 103.766 106.725 105.291 100.736C109.928 99.4153 113.258 94.2523 115.004 89.9461C116.715 85.6941 117.817 81.0221 117.418 76.4131C117.198 73.8619 116.641 70.2608 114.552 68.5075C113.174 67.3346 111.096 67.4052 109.317 68.1879C109.336 67.4973 109.351 66.8203 109.363 66.1585V66.0744C109.363 65.98 109.366 65.8855 109.368 65.791Z" fill="#FFAB80"/>\n' +
                        '<path fill-rule="evenodd" clip-rule="evenodd" d="M9.14155 72.1585C9.22325 78.046 10.4903 85.6718 11.7473 93.2366C12.1826 95.8567 12.6168 98.4694 13 101C12.534 100.951 12.5147 100.928 12.4359 100.836C12.3801 100.77 12.2946 100.67 12 100.5C11.5345 97.1747 10.9367 93.7388 10.3459 90.3424C9.19622 83.734 8.07265 77.2755 8 72.0744V71C7.98929 70.0511 7.99212 69.6401 7.99565 69.1269C7.99771 68.828 8 68.4945 8 68C8.30544 68.1823 8.48028 68.2456 8.59607 68.2876C8.82042 68.3689 8.82311 68.3698 9.12461 69C9.12461 69.7769 9.13309 71.2451 9.14155 72.0744V72.1585ZM88.4598 138.852C77.331 151.168 65.4988 156.417 59 156.417C52.5012 156.417 40.669 151.168 29.5402 138.852L29.8972 131.902C40.9315 143.934 52.5747 149.068 59 149.068C65.4253 149.068 77.0685 143.934 88.1028 131.902L88.4598 138.852ZM110.004 69.1318C110.002 68.8343 110 68.501 110 68C109.574 68.2719 109.466 68.1528 109.409 68.0899C109.353 68.0277 109.346 68.0204 109.132 68.5C109.132 68.9029 109.094 69.5364 109.056 70.1708C109.02 70.7718 108.984 71.3736 108.98 71.7809V71.8658C108.909 77.3243 107.737 84.2687 106.553 91.2843C106.001 94.5552 105.447 97.8415 105 101C105.46 100.948 105.48 100.927 105.58 100.824C105.644 100.759 105.74 100.66 106 100.5C106.475 96.8697 107.126 93.1358 107.765 89.4704C108.867 83.1496 109.934 77.0323 110 72V71C110.01 70.0438 110.007 69.6401 110.004 69.1318Z" fill="black" fill-opacity="0.1"/>\n' +
                        '</svg>'},
                { type: 'hair', svg: '<svg width="14" height="14" viewBox="0 0 121 125" fill="none" xmlns="http://www.w3.org/2000/svg">\n' +
                        '<path fill-rule="evenodd" clip-rule="evenodd" d="M1.59287 100.541C1.96882 98.709 2.78883 96.999 3.97988 95.5635C3.87884 106.094 7.06371 116.391 13.085 125C6.62528 63.3468 19.3478 52.5198 19.3478 52.5198C19.3478 52.5198 57.5647 81.5639 100.018 52.4413C100.018 52.4413 113.467 63.3427 107.007 124.996C113.467 115.392 114.923 107.204 115.39 95.2743C116.974 96.8341 118.006 98.8746 118.327 101.082C118.327 101.082 125.603 63.6153 109.492 42.9156C110.953 40.5899 118.413 34.0796 120.718 34.2366C123.023 34.3936 110.875 29.2796 96.1096 31.7581C99.6157 28.0381 103.725 24.9467 108.262 22.6165C100.767 21.1534 93.1149 20.684 85.4993 21.2203C89.7725 17.9806 94.4206 15.2757 99.3415 13.1651C87.4784 9.54173 74.8383 9.3813 62.8883 12.7024C67.1543 7.63134 72.2525 3.3349 77.9609 0C77.9609 0 39.0509 2.1687 18.749 31.2913C17.4238 26.6646 17.5614 21.7371 19.1428 17.1927C19.1428 17.1927 -6.54431 41.478 1.59287 100.541Z" fill="#AA8628"/>\n' +
                        '<path d="M19 51.5C19 51.5 37.4707 64.9937 59 64C91.5 62.5 109.5 43 109.5 43C109.5 43 92 66.5 62.5 68C37.5323 69.2695 18 53 18 53L19 51.5Z" fill="black" fill-opacity="0.1"/>\n' +
                        '</svg>'},
                { type: 'eyes', svg: '<svg width="14" height="14" viewBox="0 0 102 21" fill="none" xmlns="http://www.w3.org/2000/svg">\n' +
                        '<mask id="path-1-outside-1_2_247" maskUnits="userSpaceOnUse" x="-0.5" y="0.216118" width="103" height="21" fill="black">\n' +
                        '<rect fill="white" x="-0.5" y="0.216118" width="103" height="21"/>\n' +
                        '<path fill-rule="evenodd" clip-rule="evenodd" d="M47.3623 4.25218C33.8676 0.863179 19.7197 0.303136 5.9586 2.61361C5.83819 2.63383 5.75 2.73807 5.75 2.86016V2.95455L0.5 2V3.5L5.75 5.40909V5.83062C5.75 5.94707 5.83041 6.04811 5.9439 6.07424L9.53398 6.90093C9.63547 10.2271 10.1989 13.5339 11.2156 16.7396C11.2389 16.813 11.2947 16.8716 11.3669 16.8984C20.9987 20.4741 31.5817 21.2697 41.7146 19.1804C41.7912 19.1646 41.856 19.1138 41.8897 19.0432C44.1138 14.3818 46.0213 9.59755 47.6013 4.71812C48.0236 4.28733 48.5508 3.95168 49.142 3.73955C49.742 3.52422 50.3896 3.44274 51.0313 3.50226C51.039 3.50297 51.0467 3.50332 51.0544 3.50332C52.4633 3.50332 53.3322 3.81142 53.8407 4.10351C54.0956 4.24994 54.2628 4.39398 54.3639 4.49714C54.4145 4.5488 54.4487 4.59042 54.4691 4.61723C54.473 4.62233 54.4764 4.6269 54.4793 4.6309C56.0648 9.54054 57.9818 14.354 60.2191 19.0432C60.2528 19.1138 60.3176 19.1646 60.3943 19.1804C70.5271 21.2697 81.1101 20.4741 90.7419 16.8984C90.8141 16.8716 90.8699 16.813 90.8932 16.7396C91.9099 13.5339 92.4734 10.2271 92.5749 6.90093L96.1649 6.07424C96.2784 6.04811 96.3588 5.94707 96.3588 5.83062V5.36951L101.5 3.5V2L96.3588 2.93476V2.86016C96.3588 2.73807 96.2707 2.63383 96.1502 2.61361C82.4088 0.306441 68.2817 0.861583 54.8045 4.23766C54.7807 4.21022 54.753 4.17989 54.721 4.14724C54.5894 4.01288 54.3861 3.84021 54.0897 3.66995C53.4971 3.32951 52.5434 3.005 51.0659 3.00333C50.3558 2.93917 49.639 3.02997 48.9731 3.26893C48.3668 3.4865 47.8175 3.82164 47.3623 4.25218ZM9.66357 2.56623C9.54845 3.83835 9.50141 5.11282 9.52194 6.38507L6.25 5.63164V3.07191C7.38544 2.88373 8.52349 2.71518 9.66357 2.56623ZM11.6556 16.472C10.2344 11.938 9.73149 7.20221 10.1717 2.50116C22.4978 0.954497 35.0495 1.6966 47.0824 4.69754C45.5304 9.47053 43.6635 14.1519 41.492 18.7156C31.5274 20.7466 21.1295 19.9646 11.6556 16.472ZM55.0265 4.69754C56.5785 9.47053 58.4454 14.1519 60.6169 18.7156C70.5815 20.7466 80.9793 19.9646 90.4533 16.472C91.8745 11.938 92.3773 7.2022 91.9372 2.50116C79.611 0.954497 67.0593 1.6966 55.0265 4.69754ZM92.4453 2.56623C92.5604 3.83835 92.6074 5.11282 92.5869 6.38507L95.8588 5.63164V3.07191C94.7234 2.88373 93.5854 2.71518 92.4453 2.56623Z"/>\n' +
                        '</mask>\n' +
                        '<path fill-rule="evenodd" clip-rule="evenodd" d="M47.3623 4.25218C33.8676 0.863179 19.7197 0.303136 5.9586 2.61361C5.83819 2.63383 5.75 2.73807 5.75 2.86016V2.95455L0.5 2V3.5L5.75 5.40909V5.83062C5.75 5.94707 5.83041 6.04811 5.9439 6.07424L9.53398 6.90093C9.63547 10.2271 10.1989 13.5339 11.2156 16.7396C11.2389 16.813 11.2947 16.8716 11.3669 16.8984C20.9987 20.4741 31.5817 21.2697 41.7146 19.1804C41.7912 19.1646 41.856 19.1138 41.8897 19.0432C44.1138 14.3818 46.0213 9.59755 47.6013 4.71812C48.0236 4.28733 48.5508 3.95168 49.142 3.73955C49.742 3.52422 50.3896 3.44274 51.0313 3.50226C51.039 3.50297 51.0467 3.50332 51.0544 3.50332C52.4633 3.50332 53.3322 3.81142 53.8407 4.10351C54.0956 4.24994 54.2628 4.39398 54.3639 4.49714C54.4145 4.5488 54.4487 4.59042 54.4691 4.61723C54.473 4.62233 54.4764 4.6269 54.4793 4.6309C56.0648 9.54054 57.9818 14.354 60.2191 19.0432C60.2528 19.1138 60.3176 19.1646 60.3943 19.1804C70.5271 21.2697 81.1101 20.4741 90.7419 16.8984C90.8141 16.8716 90.8699 16.813 90.8932 16.7396C91.9099 13.5339 92.4734 10.2271 92.5749 6.90093L96.1649 6.07424C96.2784 6.04811 96.3588 5.94707 96.3588 5.83062V5.36951L101.5 3.5V2L96.3588 2.93476V2.86016C96.3588 2.73807 96.2707 2.63383 96.1502 2.61361C82.4088 0.306441 68.2817 0.861583 54.8045 4.23766C54.7807 4.21022 54.753 4.17989 54.721 4.14724C54.5894 4.01288 54.3861 3.84021 54.0897 3.66995C53.4971 3.32951 52.5434 3.005 51.0659 3.00333C50.3558 2.93917 49.639 3.02997 48.9731 3.26893C48.3668 3.4865 47.8175 3.82164 47.3623 4.25218ZM9.66357 2.56623C9.54845 3.83835 9.50141 5.11282 9.52194 6.38507L6.25 5.63164V3.07191C7.38544 2.88373 8.52349 2.71518 9.66357 2.56623ZM11.6556 16.472C10.2344 11.938 9.73149 7.20221 10.1717 2.50116C22.4978 0.954497 35.0495 1.6966 47.0824 4.69754C45.5304 9.47053 43.6635 14.1519 41.492 18.7156C31.5274 20.7466 21.1295 19.9646 11.6556 16.472ZM55.0265 4.69754C56.5785 9.47053 58.4454 14.1519 60.6169 18.7156C70.5815 20.7466 80.9793 19.9646 90.4533 16.472C91.8745 11.938 92.3773 7.2022 91.9372 2.50116C79.611 0.954497 67.0593 1.6966 55.0265 4.69754ZM92.4453 2.56623C92.5604 3.83835 92.6074 5.11282 92.5869 6.38507L95.8588 5.63164V3.07191C94.7234 2.88373 93.5854 2.71518 92.4453 2.56623Z" fill="#BDBDBD"/>\n' +
                        '<path d="M5.9586 2.61361L6.00828 2.90947L6.00828 2.90947L5.9586 2.61361ZM47.3623 4.25218L47.2892 4.54314C47.3887 4.56811 47.494 4.54058 47.5684 4.47013L47.3623 4.25218ZM5.75 2.95455L5.69633 3.24971C5.78386 3.26562 5.87393 3.24187 5.94222 3.18487C6.01052 3.12787 6.05 3.0435 6.05 2.95455H5.75ZM0.5 2L0.553666 1.70484C0.466144 1.68893 0.376073 1.71268 0.307776 1.76967C0.239479 1.82667 0.2 1.91104 0.2 2H0.5ZM0.5 3.5H0.2C0.2 3.62615 0.27892 3.73883 0.397477 3.78194L0.5 3.5ZM5.75 5.40909H6.05C6.05 5.28294 5.97108 5.17026 5.85252 5.12715L5.75 5.40909ZM5.9439 6.07424L6.01122 5.78189L6.01122 5.78189L5.9439 6.07424ZM9.53398 6.90093L9.83384 6.89178C9.82968 6.75551 9.73416 6.63917 9.6013 6.60858L9.53398 6.90093ZM11.2156 16.7396L10.9297 16.8303L10.9297 16.8303L11.2156 16.7396ZM11.3669 16.8984L11.2625 17.1796L11.2625 17.1796L11.3669 16.8984ZM41.7146 19.1804L41.7752 19.4742L41.7752 19.4742L41.7146 19.1804ZM41.8897 19.0432L42.1605 19.1724L42.1605 19.1724L41.8897 19.0432ZM47.6013 4.71812L47.3871 4.50811C47.3546 4.54127 47.3302 4.58152 47.3159 4.6257L47.6013 4.71812ZM49.142 3.73955L49.2433 4.02191L49.2433 4.02191L49.142 3.73955ZM51.0313 3.50226L51.0036 3.80097L51.0037 3.80097L51.0313 3.50226ZM53.8407 4.10351L53.9901 3.84337L53.9901 3.84337L53.8407 4.10351ZM54.3639 4.49714L54.1496 4.70707L54.1496 4.70707L54.3639 4.49714ZM54.4691 4.61723L54.2305 4.79907L54.2305 4.79908L54.4691 4.61723ZM54.4793 4.6309L54.7648 4.53871C54.755 4.5085 54.7405 4.48003 54.7219 4.45436L54.4793 4.6309ZM60.2191 19.0432L59.9484 19.1724L59.9484 19.1724L60.2191 19.0432ZM60.3943 19.1804L60.3337 19.4742L60.3337 19.4742L60.3943 19.1804ZM90.7419 16.8984L90.6375 16.6171L90.6375 16.6171L90.7419 16.8984ZM90.8932 16.7396L90.6072 16.6489L90.6072 16.6489L90.8932 16.7396ZM92.5749 6.90093L92.5075 6.60858C92.3747 6.63917 92.2792 6.75551 92.275 6.89178L92.5749 6.90093ZM96.1649 6.07424L96.0976 5.78189L96.0976 5.78189L96.1649 6.07424ZM96.3588 5.36951L96.2563 5.08757C96.1378 5.13068 96.0588 5.24336 96.0588 5.36951H96.3588ZM101.5 3.5L101.603 3.78194C101.721 3.73883 101.8 3.62615 101.8 3.5H101.5ZM101.5 2H101.8C101.8 1.91104 101.761 1.82667 101.692 1.76967C101.624 1.71268 101.534 1.68893 101.446 1.70484L101.5 2ZM96.3588 2.93476H96.0588C96.0588 3.02371 96.0983 3.10808 96.1666 3.16508C96.2349 3.22208 96.325 3.24583 96.4125 3.22992L96.3588 2.93476ZM96.1502 2.61361L96.1006 2.90947L96.1006 2.90947L96.1502 2.61361ZM54.8045 4.23766L54.5776 4.43397C54.6517 4.51955 54.7676 4.55616 54.8773 4.52866L54.8045 4.23766ZM54.721 4.14724L54.9353 3.93731L54.9353 3.93731L54.721 4.14724ZM54.0897 3.66995L53.9403 3.93008L53.9403 3.93008L54.0897 3.66995ZM51.0659 3.00333L51.0389 3.30211C51.0478 3.30291 51.0567 3.30332 51.0656 3.30333L51.0659 3.00333ZM48.9731 3.26893L49.0744 3.5513L49.0744 3.5513L48.9731 3.26893ZM9.52194 6.38507L9.45462 6.67742C9.54452 6.69812 9.63894 6.67631 9.71065 6.61829C9.78236 6.56026 9.82339 6.47247 9.8219 6.38023L9.52194 6.38507ZM9.66357 2.56623L9.96235 2.59327C9.97055 2.50256 9.93711 2.41304 9.87145 2.34993C9.80579 2.28682 9.71501 2.25696 9.6247 2.26876L9.66357 2.56623ZM6.25 5.63164H5.95C5.95 5.77139 6.04649 5.89263 6.18268 5.92399L6.25 5.63164ZM6.25 3.07191L6.20095 2.77595C6.05617 2.79995 5.95 2.92516 5.95 3.07191H6.25ZM10.1717 2.50116L10.1343 2.20349C9.99475 2.22101 9.88609 2.33314 9.87298 2.47319L10.1717 2.50116ZM11.6556 16.472L11.3693 16.5618C11.3971 16.6505 11.4645 16.7214 11.5518 16.7535L11.6556 16.472ZM47.0824 4.69754L47.3676 4.7903C47.3934 4.71117 47.3851 4.62491 47.3448 4.55213C47.3044 4.47935 47.2357 4.42659 47.1549 4.40645L47.0824 4.69754ZM41.492 18.7156L41.5519 19.0096C41.6442 18.9908 41.7224 18.9296 41.7628 18.8445L41.492 18.7156ZM60.6169 18.7156L60.346 18.8445C60.3865 18.9296 60.4646 18.9908 60.557 19.0096L60.6169 18.7156ZM55.0265 4.69754L54.9539 4.40645C54.8732 4.42659 54.8044 4.47935 54.7641 4.55213C54.7238 4.62491 54.7155 4.71117 54.7412 4.7903L55.0265 4.69754ZM90.4533 16.472L90.5571 16.7535C90.6443 16.7214 90.7117 16.6505 90.7396 16.5618L90.4533 16.472ZM91.9372 2.50116L92.2359 2.47319C92.2228 2.33314 92.1141 2.221 91.9745 2.20349L91.9372 2.50116ZM92.5869 6.38507L92.2869 6.38023C92.2854 6.47247 92.3265 6.56026 92.3982 6.61829C92.4699 6.67632 92.5643 6.69812 92.6542 6.67742L92.5869 6.38507ZM92.4453 2.56623L92.4841 2.26875C92.3938 2.25696 92.3031 2.28682 92.2374 2.34993C92.1717 2.41304 92.1383 2.50256 92.1465 2.59326L92.4453 2.56623ZM95.8588 5.63164L95.9262 5.92399C96.0624 5.89263 96.1588 5.77139 96.1588 5.63164H95.8588ZM95.8588 3.07191H96.1588C96.1588 2.92516 96.0527 2.79995 95.9079 2.77595L95.8588 3.07191ZM6.00828 2.90947C19.7287 0.605828 33.8348 1.16425 47.2892 4.54314L47.4354 3.96121C33.9004 0.562104 19.7107 0.000444599 5.90893 2.31776L6.00828 2.90947ZM6.05 2.86016C6.05 2.88458 6.03236 2.90543 6.00828 2.90947L5.90893 2.31776C5.64403 2.36223 5.45 2.59155 5.45 2.86016H6.05ZM6.05 2.95455V2.86016H5.45V2.95455H6.05ZM0.446334 2.29516L5.69633 3.24971L5.80367 2.65938L0.553666 1.70484L0.446334 2.29516ZM0.8 3.5V2H0.2V3.5H0.8ZM5.85252 5.12715L0.602523 3.21806L0.397477 3.78194L5.64748 5.69103L5.85252 5.12715ZM6.05 5.83062V5.40909H5.45V5.83062H6.05ZM6.01122 5.78189C6.03392 5.78712 6.05 5.80732 6.05 5.83062H5.45C5.45 6.08682 5.62691 6.3091 5.87658 6.36659L6.01122 5.78189ZM9.6013 6.60858L6.01122 5.78189L5.87658 6.36659L9.46666 7.19328L9.6013 6.60858ZM11.5016 16.6489C10.4932 13.4695 9.93449 10.1901 9.83384 6.89178L9.23412 6.91008C9.33646 10.2641 9.90465 13.5983 10.9297 16.8303L11.5016 16.6489ZM11.4714 16.6171C11.4858 16.6225 11.497 16.6342 11.5016 16.6489L10.9297 16.8303C10.9809 16.9918 11.1037 17.1207 11.2625 17.1796L11.4714 16.6171ZM41.654 18.8866C31.5758 20.9646 21.05 20.1732 11.4714 16.6171L11.2625 17.1796C20.9474 20.7751 31.5876 21.5748 41.7752 19.4742L41.654 18.8866ZM41.619 18.914C41.6257 18.8999 41.6387 18.8897 41.654 18.8866L41.7752 19.4742C41.9438 19.4394 42.0864 19.3278 42.1605 19.1724L41.619 18.914ZM47.3159 4.6257C45.74 9.49248 43.8374 14.2644 41.619 18.914L42.1605 19.1724C44.3902 14.4991 46.3026 9.70262 47.8867 4.81054L47.3159 4.6257ZM49.0406 3.45718C48.4084 3.68407 47.8422 4.04388 47.3871 4.50811L47.8156 4.92812C48.2051 4.53077 48.6933 4.21929 49.2433 4.02191L49.0406 3.45718ZM51.0591 3.20354C50.374 3.14001 49.6823 3.22689 49.0406 3.45718L49.2433 4.02191C49.8016 3.82155 50.4051 3.74547 51.0036 3.80097L51.0591 3.20354ZM51.0544 3.20332C51.056 3.20332 51.0575 3.2034 51.059 3.20354L51.0037 3.80097C51.0205 3.80254 51.0375 3.80332 51.0544 3.80332V3.20332ZM53.9901 3.84337C53.4302 3.52175 52.5084 3.20332 51.0544 3.20332V3.80332C52.4182 3.80332 53.2342 4.1011 53.6912 4.36364L53.9901 3.84337ZM54.5782 4.2872C54.4588 4.16532 54.2699 4.0041 53.9901 3.84337L53.6912 4.36364C53.9213 4.49578 54.0668 4.62263 54.1496 4.70707L54.5782 4.2872ZM54.7077 4.43539C54.6801 4.39918 54.6378 4.34812 54.5782 4.2872L54.1496 4.70707C54.1911 4.74948 54.2172 4.78165 54.2305 4.79907L54.7077 4.43539ZM54.7219 4.45436C54.7177 4.44869 54.713 4.44235 54.7077 4.43539L54.2305 4.79908C54.233 4.80232 54.2351 4.80511 54.2367 4.80744L54.7219 4.45436ZM60.4899 18.914C58.2582 14.2367 56.3462 9.43561 54.7648 4.53871L54.1938 4.72309C55.7834 9.64546 57.7054 14.4713 59.9484 19.1724L60.4899 18.914ZM60.4548 18.8866C60.4702 18.8897 60.4831 18.8999 60.4899 18.914L59.9484 19.1724C60.0225 19.3278 60.1651 19.4394 60.3337 19.4742L60.4548 18.8866ZM90.6375 16.6171C81.0588 20.1732 70.533 20.9646 60.4548 18.8866L60.3337 19.4742C70.5212 21.5748 81.1614 20.7751 90.8463 17.1796L90.6375 16.6171ZM90.6072 16.6489C90.6119 16.6342 90.6231 16.6225 90.6375 16.6171L90.8463 17.1796C91.0052 17.1207 91.1279 16.9918 91.1792 16.8303L90.6072 16.6489ZM92.275 6.89178C92.1744 10.1901 91.6156 13.4695 90.6072 16.6489L91.1792 16.8303C92.2042 13.5983 92.7724 10.2641 92.8747 6.91008L92.275 6.89178ZM96.0976 5.78189L92.5075 6.60858L92.6422 7.19328L96.2323 6.36659L96.0976 5.78189ZM96.0588 5.83062C96.0588 5.80733 96.0749 5.78712 96.0976 5.78189L96.2323 6.36659C96.482 6.3091 96.6588 6.08682 96.6588 5.83062H96.0588ZM96.0588 5.36951V5.83062H96.6588V5.36951H96.0588ZM101.397 3.21806L96.2563 5.08757L96.4614 5.65145L101.603 3.78194L101.397 3.21806ZM101.2 2V3.5H101.8V2H101.2ZM96.4125 3.22992L101.554 2.29516L101.446 1.70484L96.3052 2.63959L96.4125 3.22992ZM96.0588 2.86016V2.93476H96.6588V2.86016H96.0588ZM96.1006 2.90947C96.0765 2.90543 96.0588 2.88458 96.0588 2.86016H96.6588C96.6588 2.59156 96.4648 2.36223 96.1999 2.31776L96.1006 2.90947ZM54.8773 4.52866C68.3144 1.16266 82.3998 0.609123 96.1006 2.90947L96.1999 2.31776C82.4178 0.00375856 68.249 0.560504 54.7316 3.94665L54.8773 4.52866ZM54.5067 4.35718C54.5343 4.38531 54.5578 4.4111 54.5776 4.43397L55.0313 4.04134C55.0036 4.00934 54.9717 3.97446 54.9353 3.93731L54.5067 4.35718ZM53.9403 3.93008C54.2118 4.08605 54.3934 4.24154 54.5067 4.35718L54.9353 3.93731C54.7854 3.78423 54.5604 3.59438 54.2391 3.40981L53.9403 3.93008ZM51.0656 3.30333C52.4981 3.30495 53.3989 3.61911 53.9403 3.93008L54.2391 3.40981C53.5952 3.03991 52.5888 2.70506 51.0663 2.70333L51.0656 3.30333ZM49.0744 3.5513C49.6988 3.32722 50.3719 3.24184 51.0389 3.30211L51.0929 2.70455C50.3398 2.6365 49.5791 2.73272 48.8717 2.98656L49.0744 3.5513ZM47.5684 4.47013C47.9926 4.06894 48.506 3.7553 49.0744 3.5513L48.8717 2.98656C48.2277 3.21771 47.6424 3.57435 47.1562 4.03422L47.5684 4.47013ZM9.8219 6.38023C9.80154 5.11861 9.84819 3.85478 9.96235 2.59327L9.36479 2.53919C9.24871 3.82192 9.20127 5.10703 9.22198 6.38991L9.8219 6.38023ZM6.18268 5.92399L9.45462 6.67742L9.58926 6.09272L6.31732 5.33929L6.18268 5.92399ZM5.95 3.07191V5.63164H6.55V3.07191H5.95ZM9.6247 2.26876C8.48123 2.41815 7.33978 2.58721 6.20095 2.77595L6.29905 3.36788C7.4311 3.18026 8.56576 3.01221 9.70243 2.8637L9.6247 2.26876ZM9.87298 2.47319C9.42906 7.21416 9.93628 11.9899 11.3693 16.5618L11.9418 16.3823C10.5325 11.886 10.0339 7.19025 10.4704 2.52913L9.87298 2.47319ZM47.1549 4.40645C35.086 1.39651 22.497 0.652244 10.1343 2.20349L10.209 2.79882C22.4986 1.25675 35.013 1.99669 47.0098 4.98862L47.1549 4.40645ZM41.7628 18.8445C43.9399 14.2692 45.8116 9.57572 47.3676 4.7903L46.7971 4.60477C45.2491 9.36533 43.387 14.0347 41.2211 18.5867L41.7628 18.8445ZM11.5518 16.7535C21.0785 20.2655 31.5331 21.0517 41.5519 19.0096L41.432 18.4217C31.5217 20.4416 21.1806 19.6637 11.7593 16.1906L11.5518 16.7535ZM60.8878 18.5867C58.7218 14.0347 56.8597 9.36533 55.3118 4.60477L54.7412 4.7903C56.2972 9.57572 58.1689 14.2692 60.346 18.8445L60.8878 18.5867ZM90.3495 16.1906C80.9283 19.6637 70.5871 20.4416 60.6768 18.4217L60.557 19.0096C70.5758 21.0517 81.0303 20.2655 90.5571 16.7535L90.3495 16.1906ZM91.6385 2.52913C92.0749 7.19025 91.5763 11.886 90.167 16.3823L90.7396 16.5618C92.1726 11.9899 92.6798 7.21416 92.2359 2.47319L91.6385 2.52913ZM55.0991 4.98862C67.0958 1.99669 79.6102 1.25675 91.8998 2.79882L91.9745 2.20349C79.6118 0.652244 67.0229 1.39651 54.9539 4.40645L55.0991 4.98862ZM92.8869 6.38992C92.9076 5.10703 92.8601 3.82192 92.7441 2.53919L92.1465 2.59326C92.2607 3.85478 92.3073 5.11861 92.2869 6.38023L92.8869 6.38992ZM95.7915 5.33929L92.5196 6.09273L92.6542 6.67742L95.9262 5.92399L95.7915 5.33929ZM95.5588 3.07191V5.63164H96.1588V3.07191H95.5588ZM92.4064 2.8637C93.5431 3.01221 94.6777 3.18026 95.8098 3.36788L95.9079 2.77595C94.7691 2.58721 93.6276 2.41815 92.4841 2.26875L92.4064 2.8637Z" fill="#595959" fill-opacity="0.5" mask="url(#path-1-outside-1_2_247)"/>\n' +
                        '<path fill-rule="evenodd" clip-rule="evenodd" d="M11.454 16.664C9.98035 12.0174 9.46558 7.15739 9.93643 2.33598C22.4562 0.701862 35.2065 1.44516 47.4027 4.52014C45.8185 9.43093 43.9019 14.2455 41.6642 18.9356C31.5769 21.0155 21.0416 20.2234 11.454 16.664ZM54.7062 4.56385C66.8471 1.45511 79.5554 0.696562 92.0302 2.33601C92.5515 7.16634 92.0686 12.0439 90.6075 16.7077C81.03 20.2414 70.5182 21.0331 60.4448 18.9793C58.2168 14.2856 56.3004 9.47157 54.7062 4.56385Z" fill="#F16F6F"/>\n' +
                        '<path fill-rule="evenodd" clip-rule="evenodd" d="M61.525 19.242C61.3381 19.1815 61.0627 19.0925 60.4448 18.9355C58.2731 14.236 56.4044 9.42249 54.8485 4.52012C66.9893 1.41139 79.6976 0.652838 92.1725 2.29228V3.5C81.435 2.25196 67.6831 3.90429 57 5.5C58.5512 9.86171 60.7624 15.399 63 19.5C61.9064 19.3653 61.8467 19.346 61.525 19.242ZM47.5 4.49999L47 5.99999C36.7469 3.37089 22.0434 2.51641 11.454 3.49999C11.6106 7.81736 11.9589 13.4201 13.5 17.5C12.5305 17.2795 12.5247 17.2757 12.3647 17.1688C12.2548 17.0954 12.0721 16.9733 11.454 16.699C9.98035 12.0523 9.46558 7.19237 9.93643 2.37096C22.1437 0.741385 35.5814 1.57342 47.5 4.49999Z" fill="black" fill-opacity="0.1"/>\n' +
                        '</svg>'},
                { type: 'lips', svg: '4'},
                { type: 'other1', svg: '5'},
                { type: 'other2', svg: '6'},
                { type: 'other3', svg: '7'},
                { type: 'garb', svg: '8'}
            ]
        }
    },
    mounted() {
        if (this.id === null) {
            this.uid = this.$route.params.id;
        } else {
            this.uid = this.id;
        }
        this.GetElementsAndColors();
    },
    methods: {
        ...mapActions(['GET_AVATAR_EDIT_OPTIONS']),
        GetElementsAndColors() {
            this.GET_AVATAR_EDIT_OPTIONS(this.uid).then(res => {
                this.colors = res.colors;
                this.elems = res.elements;
                this.result.map(e => {
                    for (let el of res.user_avatar) {
                        if (e.type === el.type) {
                            e.color_id = el.color_id;
                            e.element_id = el.element_id;
                        }
                    }
                });
                this.createSvg();
            });
        },

        colorize(color) {
            return `background-color: ${color};`;
        },

        createSvg () {
            let elGroup = ``;
            for (let elem of this.result) {
                const path = this.createPath(elem);
                for (let str of path) {
                    elGroup += `${str}`
                }
            }
            this.fullSvg = `<svg width="256" height="256" viewBox="0 0 256 256" fill="none" xmlns="http://www.w3.org/2000/svg"> ${elGroup} </svg>`;
            this.res({img: this.fullSvg, img_edit: this.result.filter(e => e.element_id || e.color_id)});
        },

        createPath (elem) {
            let el = this.elems.filter(e => e.type === elem.type);
            let path = ''
            let elPath = []
            el = this.changeFill(el, elem.color_id)
            if (el) {
                for (let e of el) {
                    if (e.id !== elem.element_id) continue
                    for (let i of e.svg) {
                        elPath = []
                        for (let key in i) {
                            if (key === 'fill_edit') continue
                            elPath.push(`${key.split('_').join('-')}='${i[key]}' `)
                        }
                        path += `<path ${elPath.join(' ')}/> `
                    }
                }
            }
            return path
        },

        changeFill (el, color_id) {
            return el.map(e => {
                e.svg.map(i => {
                    if (i.fill_edit) i.fill = this.getColor(color_id);
                });
                return e;
            });
        },

        getColor(color_id) {
            return this.colors.filter(e => e.id === color_id)[0] ? this.colors.filter(e => e.id === color_id)[0].color : null;
        },

        setFillSvg (color) {
            this.result.map(e => {
                if(e.type === this.target){
                    e.color_id = color.id;
                }
            });
            this.createSvg()
        },

        getFillSvg (color) {
            return this.result.filter(e => e.type === this.target)[0].color_id === color.id;
        },

        setTargetSvg (move) {
            const el = this.result.filter(e => e.type === this.target)[0];
            const id = el.element_id;
            let flag = false;
            if (move === 'next') {
                for (let e of this.els) {
                    el.element_id = e.id;
                    if (flag) continue;
                    if (e.id === id) flag = true;
                }
            } else {
                for (let e of this.els) {
                    if (e.id === id) flag = true;
                    if (flag) continue;
                    el.element_id = e.id;
                }
            }
            this.createSvg()
        },

        disabledOn() {
            return this.els.length <= 1 && this.result.filter(e => e.type === this.target)[0].element_id !== null;
        },

        res(r) {
            this.$emit('res', r);
        }
    },
    watch: {
        target() {
            this.els = this.elems.filter(e => e.type === this.target);
        }
    }
}
</script>

<style scoped>

</style>
